---
title: æ‰‹å†™ debounce å’Œ throttle
date: '2023-11-25'
tags: ['JavaScript', 'Debounce', 'Throttle']
draft: false
---

# Debounce and Throttle

> Throttle æ˜¯ä¸ªä¸ä¼šè¢«æ‰“æ–­æ–½æ³•çš„ğŸ§™ğŸ¼â€â™‚ï¸æœ¯å£«ï¼ŒDebounce æ˜¯ä¸ªå° ğŸŒ¶ï¸ ğŸ” æ¯æ¬¡è¢«æ‰“æ–­éœ€è¦é‡æ–°è¯» delay æ¡

ä»å‘½åè§’åº¦å¾ˆå®¹æ˜“ç†è§£ä¸¤ä¸ªå‡½æ•°çš„ä½œç”¨ï¼Œ`Throttle` åœ¨ä¸€æ®µæ—¶é—´å†…åªä¼šæ‰§è¡Œä¸€æ¬¡è§¦å‘äº‹ä»¶çš„å›è°ƒï¼Œå…¶ä½™çš„å›è°ƒä¼šè¢«â€œèŠ‚æµâ€ã€‚`Debounce` é¡¾åæ€ä¹‰ de-bounce, å°†å¤šæ¬¡äº‹ä»¶ä¼˜åŒ–æˆæœ€åä¸€æ¬¡æ‰§è¡Œã€‚

ä¸¾ğŸŒ°ï¼š

- ç›‘å¬é¡µé¢æ»šåŠ¨äº‹ä»¶ï¼Œæ»šåŠ¨æ¡ä¸åœä¸Šä¸‹æ»šåŠ¨ï¼Œé€ æˆè¾ƒå¤§å¼€é”€ã€‚åº”è¯¥ä½¿ç”¨ï¼Ÿ â€”â€” Throttle, ä¸€æ®µæ—¶é—´å†…å¤šä½™çš„å›è°ƒåº”è¯¥ omit, å¹¶ä¸”å¸Œæœ›å¯¹ç”¨æˆ·è¡Œä¸ºä½œå‡ºåé¦ˆ
- ç›‘å¬æœç´¢æ¡†çš„æ–‡å­—å˜æ›´åè§¦å‘æ ¡éªŒï¼Œä¸åœæ›´æ”¹å†…å®¹ï¼Œå¯¼è‡´é¢‘ç¹æ ¡éªŒç”šè‡³å¡é¡¿ï¼Œåº”è¯¥ä½¿ç”¨ï¼Ÿ â€”â€” Debounce, åªå½“ x ms åä¸å˜æ›´æ–‡å­—æ—¶ï¼Œæ‰è¿›è¡Œâ€œæœ‰æ„ä¹‰â€çš„æ ¡éªŒ

## Debounce

å…ˆåˆ«æ€¥ï¼Œè¿™æ®µä»£ç ä»…ä»…æ˜¯æœ€åŸºç¡€çš„ï¼Œæ¥ä¸‹æ¥ä¼šç”¨ throttle äº†è§£è¿˜æœ‰ä»€ä¹ˆå¯æ·±å…¥çš„ã€‚

```js
const debounce = function (fn, delay = 300) {
  let timer = null
  return function () {
    const context = this
    const args = arguments

    timer && clearTimeout(timer)
    timer = setTimeout(() => {
      fn.apply(context, args)
    }, delay)
  }
}
```

## Throttle

æŒ‰å‰é¢ debounce çš„æ€è·¯ï¼Œç›´æ¥å¤åˆ»ï¼Œä½†ä¸ä¼šæ‰“æ–­æ–½æ³•

```js
const basicThrottle = function (fn, delay = 300) {
  let timer = null
  return function () {
    if (timer) return

    const context = this
    const args = arguments

    timer = setTimeout(() => {
      fn.apply(context, arguments)
      timer = null
    }, delay)
  }
}
```

ä½†æ˜¯ä½¿ç”¨ `lodash` ä¼šå‘ç°ï¼Œ`throttle` è¿˜æœ‰ç¬¬ä¸‰ä¸ªå‚æ•°ï¼š

- `options.leading=true` (boolean): invoking on the leading edge of the timeout
- `options.trailing=true` (boolean): invoking on the trailing edge of the timeout

* ä½¿ç”¨ throttle å‰:

  <img src="static/images/before-throttle.webp" alt="before-throttle" />

* ä½¿ç”¨ defaylt throttle (leading: true, trailing: true) å:

  <img src="static/images/default-throttle.webp" alt="default-throttle" />

* é¦–èŠ‚æµ â€” {leading: true, trailing: false}

  <img src="static/images/leading-throttle.webp" alt="leading-throttle" />

* å°¾èŠ‚æµ â€” {leading: false, trailing: true}

  <img src="static/images/trailing-throttle.webp" alt="trailing-throttle" />

æŒ‰ç…§`lodash`çš„æ¦‚å¿µï¼Œä¸Šé¢çš„é‚£æ®µ`basicThrottle`çš„ options é…ç½®åº”ä¸º { leading: false, trailing: false }ã€‚å°½ç®¡ç¬¬ä¸€æ¬¡çš„å›è°ƒä¼šè§¦å‘ï¼Œä½†æ˜¯åœ¨ `delay` åï¼Œè€Œä¸æ˜¯ç«‹å³æ‰§è¡Œã€‚

ä¸ºäº†éªŒè¯ï¼Œæˆ‘ä»¬å†™ä¸ªæµ‹è¯•:

```
// Console
a = basicThrottle(console.debug, 3000)
[a(1), a(2), a(3)] // 3s å log 1
```

æ¥ä¸‹æ¥æˆ‘ä»¬å®ç°å®Œæ•´çš„ `options`ã€‚

```js
const throttle = function (fn, delay = 300, options = { leading: true, trailing: true }) {
  let timer = null
  let context = null
  let args = null

  const later = () => {
    if (option.trailing && args) {
      func.apply(context, args)
      context = null
      args = null
      timer = setTimeout(later, delay)
    } else {
      timer = null
    }
  }

  return function () {
    if (timer) {
      context = this
      args = arguments
      return
    }
    if (option.leading) {
      func.apply(this, args)
    } else {
      context = this
      args = args
    }

    timer = setTimeout(later, delay)
  }
}
```

---

# å‚è€ƒ

- [Throttle & Debounce behavior (lodash)](https://ellenaua.medium.com/throttle-debounce-behavior-lodash-6bcae1494e03)
- [Write a better throttle function with Underscore](https://gist.github.com/pinglu85/fbe672cb84faa987a1e97e20d844b108)
